---
title: "Pagina Web_G2"
author: "Lopez, Mego, Puerta, Rodriguez, Tucto, Vela"
format:
  html:
    toc: true
    toc-location: left
    number-sections: true
    embed-resources: true
    smooth-scroll: true
    anchor-sections: true
    output-file: index
    fontsize: 1.1em
    linestretch: 1.7
    css: estilo.css
    highlight-style: tomorrow-night
    code-fold: true
footer: "© 2024 Lopez, Mego, Puerta, Rodriguez, Tucto, Vela| Todos los derechos reservados"
editor_options: 
  chunk_output_type: console 
---

# INTRODUCCIÓN

La papa es uno de los cultivos más importantes del mundo y un pilar económico para más de 600 mil pequeños agricultores en el Perú, que es uno de los principales productores de este tubérculo en Latinoamérica. Sin embargo, el cambio climático está generando nuevos desafíos en su producción, ya que cada vez se cuenta con menos recursos hídricos para satisfacer la demanda alimentaria de una población en constante crecimiento. Además, la papa es particularmente sensible a la falta de agua, lo cual afecta tanto su rendimiento como la calidad de sus tubérculos el presente estudio busca identificar genotipos de papa que puedan adaptarse mejor a condiciones de sequía, sin perder su capacidad de producir de manera eficiente.

# DESARROLLO


Material biológico: Se utilizaron quince (15) genotipos de papa provenientes de poblaciones de mejoramiento del Centro Internacional de la Papa


# RESULTADOS
Importar base de datos:
```{r}
source('https://inkaverse.com/setup.r')
library(readxl)
dat <- read_excel("C:/Users/PC/OneDrive/Desktop/dat.xlsx")

str(dat)

```

## PESO SECO DEL TUBERCULO (g)
### Modelo lineal

```{r}
modelo <- lm(formula = tubdw ~ bloque + geno + riego +riego*geno , data = dat)

anova(modelo)

```
*Interpretación*:......

*Prueba de normalidad*
```{r}
plot(modelo)
```


*Interacción de niveles de riego y geno*
```{r}
library(ggplot2)

ggplot(dat, aes(x = geno, y = tubdw, colour = riego)) + 
         geom_boxplot(outlier.colour = "blue", outlier.shape = 16, outlier.size = 2) + 
         labs(title = "Boxplot con interacción de niveles de riego y genotipo",
              x = "Interacción riego y genotipo",
              y = "peso seco del tubérculo")
```

### Modelo lineal mixto
```{r}
library(lme4)
library(lmerTest)
modelo <- lme4::lmer(formula = tubdw ~ riego + geno +riego*geno + (1 | bloque), data = dat)

anova(modelo)
```
*eliminacion de valores atipicos*
```{r}
ol <- boxplot(tubdw ~ riego * geno, dat)
ol
```
*Valores atipicos: Inti*
```{r}
library(inti)
model <- remove_outliers(data = dat
                         ,formula = tubdw ~ riego + geno +riego*geno + (1 | bloque)
                         , plot_diag = T
                         )
model
```

### comparación de medias
*library*
```{r}
library(agricolae)
library(tidyverse)
library(agricolae)
modelo <- lm(formula = tubdw ~ bloque + geno + riego + riego * geno, data = dat)
anova(modelo)

 tukey_result <- HSD.test(modelo, c("geno", "riego"), group = TRUE)
 print(tukey_result)

 plot(tukey_result)

```
*Emmeans*
```{r}
library(emmeans)
library(multicmp)
library(multcompView)
cm1 <- emmeans(modelo, ~ geno | riego) %>%
  cld(Letters=letters, reversed = T)
cm1


cm2 <- emmeans(modelo, ~ riego | geno) %>%
  cld(Letters=letters, reversed = T)
cm2


cm3 <- emmeans(modelo, ~ riego * geno) %>%
  cld(Letters=letters, reversed = T)
cm3

```
*gráfico de barras con los resultados de las medias estimadas*
```{r}
df_cm1 <- as.data.frame(cm1)
str(df_cm1)

if (".group" %in% names(df_cm1)) {
  df_cm1 <- df_cm1 %>%
    dplyr::rename(groups = .group)
}

ggplot(df_cm1, aes(x = geno, y = emmean, fill = riego)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = groups), 
            position = position_dodge(width = 0.9), 
            vjust = -0.3, 
            size = 3) +  
  labs(title = "peso seco del tubérculo por Genotipo y Riego",
       x = "Genotipo",
       y = "peso seco del tubérculo") +
  theme_minimal() +
  scale_fill_discrete(name = "Riego") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


## EFICIENCIA EN EL USO DEL AGUA DE LOS TUBERCULOS (g/l)

### Modelo lineal

```{r}
modelo <- lm(formula = twue ~ bloque + geno + riego +riego*geno , data = dat)

anova(modelo)
```
*Interpretación:*......

*Prueba de normalidad*
```{r}
plot(modelo)
```

*Interacción de niveles de riego y geno*

```{r}
library(ggplot2)
ggplot(dat, aes(x = geno, y = twue , colour = riego)) +
  geom_boxplot(outlier.colour = "red", outlier.shape = 16, outlier.size = 2) +
  labs(title = "Boxplot con interacción de niveles de riego y genotipo",
       x = "Interacción Riego y Genotipo",
       y = "Eficiencia del uso del agua de los tuberculos (g/l)")

```
### Modelo lineal mixto
```{r}
library(lme4)
library(lmerTest)

model <- lme4::lmer(formula = twue ~ riego * geno + (1|bloque), data = dat)

anova(modelo)
```

*Prueba de normalidad*
```{r}
plot(modelo)
```

*Eliminación de datos atípicos*
```{r}
ol <- boxplot(twue ~ riego * geno, dat)
ol
```
*Valores atipicos: Inti*
```{r}
library(inti)

model <- remove_outliers(data = dat
                             , formula = twue ~ riego * geno + (1|bloque)
                         , plot_diag = T)
model
```

### comparacion de medias
*Library*

```{r}
library(agricolae)
library(tidyverse)
tukey_interaccion <- HSD.test(modelo, c("riego","geno"), group = TRUE)
print(tukey_interaccion)

plot(tukey_interaccion)

```

```{r}
str(tukey_interaccion)
grupos <- tukey_interaccion$groups %>% 
  rownames_to_column("Tratamientos") %>% 
  separate("Tratamientos", into = c("riego","geno"))

str(grupos)

```

*ggplot: agricolae*
```{r}
ggplot(grupos, aes(x = geno, y = twue, fill = riego)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_text(aes(label = groups), 
            position = position_dodge(width = 0.9), 
            vjust = -0.3, 
            size = 3) +  
  labs(title = "Efecto de Geno y Riego en TWUE",
       x = "Genotipo",
       y = "TWUE") +
  theme_minimal() +
  scale_fill_discrete(name = "Riego") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


## ANALISIS MULTIVARIADO
```{r}
str(dat)
```

### Correlacion

```{r}
library(tidyverse)
library(psych)
```

## ANALISIS DE COMPONENTES (PCA)
```{r}
library(FactoMineR)
mv <- dat %>%
  group_by(riego, geno) %>%
  summarise(across(where(is.numeric), ~ mean(., na.rm =TRUE))) %>%
  PCA(scale.unit = T, quali.sup = c(1:4), graph = F)

p1 <- plot(mv
     , choix="ind"
     , habillage=1)

p2 <- plot(mv
     , choix="var")
list(p1, p2) %>%
  plot_grid(plotlist = .,nrow = 1)
```


# DISCUSIÓN

# CONCLUSIONES
# REFERENCIAS BIBLIOGRÁFICAS
```{r}
"   Lozano Isla, F. (2015). Eficiencia de uso de agua en membrillo genotipos de papa (Solanum tuberosum L.) bajo condiciones de estrés hídrico por sequía [Tesis de licenciatura, Universidad Nacional Agraria La Molina]. Repositorio Institucional de la Universidad Nacional Agraria La Molina"
```






